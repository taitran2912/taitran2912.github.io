// Language translations
const translations = {
    vi: {
        'nav.home': 'Trang chủ',
        'nav.about': 'Giới thiệu',
        'nav.skills': 'Kỹ năng',
        'nav.projects': 'Dự án',
        'nav.contact': 'Liên hệ',
        'hero.title1': 'Business Analyst &',
        'hero.title2': 'System Developer',
        'hero.title3': 'Based in Ho Chi Minh City',
        'hero.description': 'Chuyên gia phân tích nghiệp vụ với kinh nghiệm phát triển hệ thống thông tin, tập trung vào việc tạo ra các giải pháp công nghệ hiệu quả và thân thiện với người dùng.',
        'hero.viewProjects': 'Xem dự án',
        'hero.contact': 'Liên hệ',
        'hero.jobTitle': 'Business Analyst',
        'stats.projects': 'Dự án hoàn thành',
        'stats.technologies': 'Công nghệ sử dụng',
        'stats.commitment': 'Cam kết chất lượng',
        'about.title': 'Giới thiệu về tôi',
        'about.subtitle': 'Tạo ra những giải pháp công nghệ có ý nghĩa',
        'about.heading': 'Crafting Meaningful<br>Systems & Intuitive<br>Digital Experiences<br>That Stand Out',
        'about.description1': 'Tôi mong muốn xây dựng sự nghiệp trong vai trò Phân tích nghiệp vụ, áp dụng kiến thức nền tảng về thu thập yêu cầu, phân tích dữ liệu và thiết kế các giải pháp hệ thống hiệu quả.',
        'about.description2': 'Là một sinh viên mới tốt nghiệp với niềm đam mê công nghệ và các giải pháp lấy người dùng làm trung tâm, tôi mong muốn được trải nghiệm môi trường chuyên nghiệp để học hỏi thực tế.',
        'about.contactNow': 'Liên hệ ngay',
        'services.analysis.title': 'Phân tích nghiệp vụ',
        'services.analysis.description': 'Thu thập yêu cầu và phân tích quy trình nghiệp vụ để tối ưu hóa hệ thống',
        'services.development.title': 'Phát triển hệ thống',
        'services.development.description': 'Xây dựng ứng dụng web với công nghệ hiện đại và trải nghiệm người dùng tốt',
        'services.data.title': 'Quản lý dữ liệu',
        'services.data.description': 'Thiết kế và tối ưu hóa cơ sở dữ liệu cho hiệu suất cao',
        'skills.title': 'Kỹ năng chuyên môn',
        'skills.subtitle': 'Công nghệ và công cụ tôi sử dụng',
        'projects.title': 'Dự án nổi bật',
        'projects.subtitle': 'Những dự án tôi đã thực hiện',
        'projects.beekeeper.title': 'Hệ thống chuỗi cửa hàng Beekeeper',
        'projects.beekeeper.description': 'Website đặt món ăn, thanh toán và quản lý cửa hàng toàn diện với giao diện thân thiện người dùng.',
        'projects.beekeeper.role': 'Trưởng nhóm (7 thành viên)',
        'projects.ecommerce.title': 'Thương mại điện tử C2C Nông sản',
        'projects.ecommerce.description': 'Nền tảng kết nối người bán và mua nông sản với tính năng chat realtime và thanh toán QR code.',
        'projects.ecommerce.features': 'QR Payment, Real-time Chat, Webhook Integration',
        'projects.role': 'Vai trò:',
        'projects.duration': 'Thời gian:',
        'projects.features': 'Tính năng:',
        'contact.title': 'Liên hệ với tôi',
        'contact.subtitle': 'Hãy cùng nhau tạo ra điều gì đó tuyệt vời',
        'contact.heading': 'Let\'s Create Something Exceptional',
        'contact.description': 'Tôi luôn sẵn sàng thảo luận về các cơ hội mới và dự án thú vị. Hãy liên hệ để chúng ta có thể trao đổi!',
        'contact.phone': 'Điện thoại',
        'contact.address': 'Địa chỉ',
        'contact.form.name': 'Họ và tên',
        'contact.form.email': 'Email',
        'contact.form.subject': 'Chủ đề',
        'contact.form.message': 'Tin nhắn',
        'contact.form.send': 'Gửi tin nhắn',
        'footer.rights': 'All rights reserved.'
    },
    en:
{
        'nav.home': 'Home',
        'nav.about': 'About',
        'nav.skills': 'Skills',
        'nav.projects': 'Projects',
        'nav.contact': 'Contact',
        'hero.title1': 'Business Analyst &',
        'hero.title2': 'System Developer',
        'hero.title3': 'Based in Ho Chi Minh City',
        'hero.description': 'Business analysis expert with experience in information system development, focusing on creating efficient and user-friendly technology solutions.',
        'hero.viewProjects': 'View Projects',
        'hero.contact': 'Contact',
        'hero.jobTitle': 'Business Analyst',
        'stats.projects': 'Projects Completed',
        'stats.technologies': 'Technologies Used',
        'stats.commitment': 'Quality Commitment',
        'about.title': 'About Me',
        'about.subtitle': 'Creating meaningful technology solutions',
        'about.heading': 'Crafting Meaningful<br>Systems & Intuitive<br>Digital Experiences<br>That Stand Out',
        'about.description1': 'I aspire to build a career as a Business Analyst, applying foundational knowledge in requirements gathering, data analysis, and designing efficient system solutions.',
        'about.description2': 'As a recent graduate with a passion for technology and user-centered solutions, I look forward to experiencing a professional environment for practical learning.',
        'about.contactNow': 'Contact Now',
        'services.analysis.title': 'Business Analysis',
        'services.analysis.description': 'Requirements gathering and business process analysis to optimize systems',
        'services.development.title': 'System Development',
        'services.development.description': 'Building web applications with modern technology and good user experience',
        'services.data.title': 'Data Management',
        'services.data.description': 'Designing and optimizing databases for high performance',
        'skills.title': 'Professional Skills',
        'skills.subtitle': 'Technologies and tools I use',
        'projects.title': 'Featured Projects',
        'projects.subtitle': 'Projects I have completed',
        'projects.beekeeper.title': 'Beekeeper Restaurant Chain System',
        'projects.beekeeper.description': 'Comprehensive food ordering, payment and restaurant management website with user-friendly interface.',
        'projects.beekeeper.role': 'Team Leader (7 members)',
        'projects.ecommerce.title': 'C2C E-commerce for Agricultural Products',
        'projects.ecommerce.description': 'Platform connecting agricultural product sellers and buyers with real-time chat and QR code payment features.',
        'projects.ecommerce.features': 'QR Payment, Real-time Chat, Webhook Integration',
        'projects.role': 'Role:',
        'projects.duration': 'Duration:',
        'projects.features': 'Features:',
        'contact.title': 'Contact Me',
        'contact.subtitle': 'Let\'s create something amazing together',
        'contact.heading': 'Let\'s Create Something Exceptional',
        'contact.description': 'I\'m always ready to discuss new opportunities and exciting projects. Let\'s get in touch so we can collaborate!',
        'contact.phone': 'Phone',
        'contact.address': 'Address',
        'contact.form.name': 'Full Name',
        'contact.form.email': 'Email',
        'contact.form.subject': 'Subject',
        'contact.form.message': 'Message',
        'contact.form.send': 'Send Message',
        'footer.rights': 'All rights reserved.'
}
}

let currentLanguage = "vi"

// Initialize everything when DOM is loaded
document.addEventListener("DOMContentLoaded", () => {
  initializeWebsite()
})

function initializeWebsite() {
  // Initialize loading screen
  initLoadingScreen()

  // Initialize particles
  initParticles()

  // Initialize AOS animations
  AOS.init({
    duration: 800,
    easing: "ease-in-out",
    once: true,
    offset: 100,
  })

  // Initialize all event listeners
  initEventListeners()

  // Initialize counters
  initCounters()

  // Initialize typing effect
  initTypingEffect()

  // Initialize skill bars animation
  initSkillBars()
}

function initLoadingScreen() {
  const loadingScreen = document.getElementById("loading-screen")

  setTimeout(() => {
    loadingScreen.classList.add("hidden")
    document.body.style.overflow = "auto"

    setTimeout(() => {
      loadingScreen.style.display = "none"
    }, 500)
  }, 2000)
}

function initParticles() {
  if (typeof particlesJS !== "undefined") {
    particlesJS("particles-js", {
      particles: {
        number: { value: 80, density: { enable: true, value_area: 800 } },
        color: { value: "#ff6b35" },
        shape: { type: "circle" },
        opacity: { value: 0.5, random: false },
        size: { value: 3, random: true },
        line_linked: {
          enable: true,
          distance: 150,
          color: "#ff6b35",
          opacity: 0.4,
          width: 1,
        },
        move: {
          enable: true,
          speed: 6,
          direction: "none",
          random: false,
          straight: false,
          out_mode: "out",
          bounce: false,
        },
      },
      interactivity: {
        detect_on: "canvas",
        events: {
          onhover: { enable: true, mode: "repulse" },
          onclick: { enable: true, mode: "push" },
          resize: true,
        },
      },
      retina_detect: true,
    })
  }
}

function initEventListeners() {
  // Mobile Navigation Toggle
  const hamburger = document.getElementById("hamburger")
  const navMenu = document.getElementById("nav-menu")

  hamburger.addEventListener("click", () => {
    navMenu.classList.toggle("active")
    hamburger.classList.toggle("active")
  })

  // Close mobile menu when clicking on a link
  document.querySelectorAll(".nav-link").forEach((link) => {
    link.addEventListener("click", () => {
      navMenu.classList.remove("active")
      hamburger.classList.remove("active")
    })
  })

  // Smooth scrolling for navigation links
  document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
    anchor.addEventListener("click", function (e) {
      e.preventDefault()
      const target = document.querySelector(this.getAttribute("href"))
      if (target) {
        target.scrollIntoView({
          behavior: "smooth",
          block: "start",
        })
      }
    })
  })

  // Navbar scroll effect
  window.addEventListener("scroll", handleScroll)

  // Language switcher
  document.querySelectorAll(".lang-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      const lang = btn.getAttribute("data-lang")
      switchLanguage(lang)
    })
  })

  // Theme toggle
  const themeToggle = document.getElementById("theme-toggle")
  themeToggle.addEventListener("click", toggleTheme)

  // Back to top button
  const backToTop = document.getElementById("backToTop")
  backToTop.addEventListener("click", () => {
    window.scrollTo({ top: 0, behavior: "smooth" })
  })

  // Contact form
  document.getElementById("contactForm").addEventListener("submit", handleFormSubmit)

  // Scroll indicator
  document.querySelector(".scroll-arrow").addEventListener("click", () => {
    document.getElementById("about").scrollIntoView({ behavior: "smooth" })
  })
}

function handleScroll() {
  const navbar = document.querySelector(".navbar")
  const backToTop = document.getElementById("backToTop")

  // Navbar scroll effect
  if (window.scrollY > 100) {
    navbar.classList.add("scrolled")
    backToTop.classList.add("visible")
  } else {
    navbar.classList.remove("scrolled")
    backToTop.classList.remove("visible")
  }

  // Active navigation link highlighting
  const sections = document.querySelectorAll("section[id]")
  const navLinks = document.querySelectorAll(".nav-link")

  let current = ""
  sections.forEach((section) => {
    const sectionTop = section.offsetTop
    const sectionHeight = section.clientHeight
    if (scrollY >= sectionTop - 200) {
      current = section.getAttribute("id")
    }
  })

  navLinks.forEach((link) => {
    link.classList.remove("active")
    if (link.getAttribute("href") === `#${current}`) {
      link.classList.add("active")
    }
  })
}

function initCounters() {
  const counters = document.querySelectorAll(".counter")
  const observerOptions = {
    threshold: 0.7,
  }

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const counter = entry.target
        const target = Number.parseInt(counter.getAttribute("data-target"))
        animateCounter(counter, target)
        observer.unobserve(counter)
      }
    })
  }, observerOptions)

  counters.forEach((counter) => observer.observe(counter))
}

function animateCounter(element, target) {
  let current = 0
  const increment = target / 50
  const timer = setInterval(() => {
    current += increment
    if (current >= target) {
      element.textContent = target
      clearInterval(timer)
    } else {
      element.textContent = Math.floor(current)
    }
  }, 30)
}

function initTypingEffect() {
  const typingElements = document.querySelectorAll(".typing-text")

  typingElements.forEach((element, index) => {
    setTimeout(() => {
      element.style.opacity = "1"
      typeWriter(element, element.textContent, 50)
    }, index * 1000)
  })
}

function typeWriter(element, text, speed) {
  element.textContent = ""
  let i = 0

  function type() {
    if (i < text.length) {
      element.textContent += text.charAt(i)
      i++
      setTimeout(type, speed)
    }
  }

  type()
}

function initSkillBars() {
  const skillBars = document.querySelectorAll(".skill-bar")
  const observerOptions = {
    threshold: 0.5,
  }

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const skillBar = entry.target
        const width = skillBar.style.width
        skillBar.style.width = "0%"

        setTimeout(() => {
          skillBar.style.width = width
        }, 200)

        observer.unobserve(skillBar)
      }
    })
  }, observerOptions)

  skillBars.forEach((bar) => observer.observe(bar))
}

function switchLanguage(lang) {
  currentLanguage = lang

  // Update active language button
  document.querySelectorAll(".lang-btn").forEach((btn) => {
    btn.classList.remove("active")
    if (btn.getAttribute("data-lang") === lang) {
      btn.classList.add("active")
    }
  })

  // Update document language
  document.documentElement.lang = lang

  // Translate all elements
  document.querySelectorAll("[data-translate]").forEach((element) => {
    const key = element.getAttribute("data-translate")
    if (translations[lang] && translations[lang][key]) {
      element.innerHTML = translations[lang][key]
    }
  })

  // Update placeholders
  document.querySelectorAll("[data-translate-placeholder]").forEach((element) => {
    const key = element.getAttribute("data-translate-placeholder")
    if (translations[lang] && translations[lang][key]) {
      element.placeholder = translations[lang][key]
    }
  })
}

function toggleTheme() {
  const body = document.body
  const themeToggle = document.getElementById("theme-toggle")
  const icon = themeToggle.querySelector("i")

  if (body.getAttribute("data-theme") === "light") {
    body.removeAttribute("data-theme")
    icon.className = "fas fa-moon"
    localStorage.setItem("theme", "dark")
  } else {
    body.setAttribute("data-theme", "light")
    icon.className = "fas fa-sun"
    localStorage.setItem("theme", "light")
  }
}

// Load saved theme
function loadTheme() {
  const savedTheme = localStorage.getItem("theme")
  const themeToggle = document.getElementById("theme-toggle")
  const icon = themeToggle.querySelector("i")

  if (savedTheme === "light") {
    document.body.setAttribute("data-theme", "light")
    icon.className = "fas fa-sun"
  }
}

// Enhanced Contact form handling with Formspree
async function handleFormSubmit(e) {
  e.preventDefault()

  const form = e.target
  const submitBtn = document.getElementById("submitBtn")
  const btnText = submitBtn.querySelector(".btn-text")
  const formStatus = document.getElementById("formStatus")

  // Get form data
  const formData = new FormData(form)
  const name = formData.get("name")
  const email = formData.get("email")
  const subject = formData.get("subject")
  const message = formData.get("message")

  // Simple validation
  if (!name || !email || !subject || !message) {
    showFormStatus("error", currentLanguage === "vi" ? "Vui lòng điền đầy đủ thông tin!" : "Please fill in all fields!")
    return
  }

  // Email validation
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
  if (!emailRegex.test(email)) {
    showFormStatus("error", currentLanguage === "vi" ? "Vui lòng nhập email hợp lệ!" : "Please enter a valid email!")
    return
  }

  // Show loading state
  submitBtn.disabled = true
  btnText.innerHTML = `<span class="spinner"></span> ${currentLanguage === "vi" ? "Đang gửi..." : "Sending..."}`
  formStatus.style.display = "none"

  try {
    // Submit to Formspree
    const response = await fetch(form.action, {
      method: "POST",
      body: formData,
      headers: {
        Accept: "application/json",
      },
    })

    if (response.ok) {
      // Success
      const successMsg =
        currentLanguage === "vi"
          ? "Cảm ơn bạn đã liên hệ! Tôi sẽ phản hồi sớm nhất có thể."
          : "Thank you for contacting me! I will respond as soon as possible."
      showFormStatus("success", successMsg)
      form.reset()
    } else {
      // Error from Formspree
      const data = await response.json()
      const errorMsg =
        currentLanguage === "vi"
          ? "Có lỗi xảy ra khi gửi tin nhắn. Vui lòng thử lại!"
          : "An error occurred while sending the message. Please try again!"
      showFormStatus("error", errorMsg)
    }
  } catch (error) {
    // Network error
    const networkErrorMsg =
      currentLanguage === "vi"
        ? "Không thể kết nối đến server. Vui lòng kiểm tra kết nối internet và thử lại!"
        : "Unable to connect to server. Please check your internet connection and try again!"
    showFormStatus("error", networkErrorMsg)
  } finally {
    // Reset button state
    submitBtn.disabled = false
    btnText.innerHTML = currentLanguage === "vi" ? "Gửi tin nhắn" : "Send Message"
  }
}

function showFormStatus(type, message) {
  const formStatus = document.getElementById("formStatus")
  formStatus.className = `form-status ${type}`

  const icon = type === "success" ? "fas fa-check-circle" : "fas fa-exclamation-circle"
  formStatus.innerHTML = `<i class="${icon}"></i>${message}`
  formStatus.style.display = "block"

  // Auto hide after 5 seconds
  setTimeout(() => {
    formStatus.style.display = "none"
  }, 5000)
}

// Initialize theme on page load
document.addEventListener("DOMContentLoaded", loadTheme)

// Add enhanced hover effects
document.addEventListener("DOMContentLoaded", () => {
  // Enhanced button hover effects
  document.querySelectorAll(".btn").forEach((btn) => {
    btn.addEventListener("mouseenter", function () {
      this.style.transform = "translateY(-3px)"
    })

    btn.addEventListener("mouseleave", function () {
      this.style.transform = "translateY(0)"
    })
  })

  // Enhanced card hover effects
  document.querySelectorAll(".about-card, .skill-category, .project-card").forEach((card) => {
    card.addEventListener("mouseenter", function () {
      this.style.transform = "translateY(-10px)"
    })

    card.addEventListener("mouseleave", function () {
      this.style.transform = "translateY(0)"
    })
  })

  // Parallax effect for hero section
  window.addEventListener("scroll", () => {
    const scrolled = window.pageYOffset
    const hero = document.querySelector(".hero")
    if (hero) {
      hero.style.transform = `translateY(${scrolled * 0.5}px)`
    }
  })
})

// Add ripple effect to buttons
document.addEventListener("click", (e) => {
  if (e.target.classList.contains("btn") || e.target.closest(".btn")) {
    const button = e.target.classList.contains("btn") ? e.target : e.target.closest(".btn")

    const ripple = document.createElement("span")
    const rect = button.getBoundingClientRect()
    const size = Math.max(rect.width, rect.height)
    const x = e.clientX - rect.left - size / 2
    const y = e.clientY - rect.top - size / 2

    ripple.style.cssText = `
            position: absolute;
            width: ${size}px;
            height: ${size}px;
            left: ${x}px;
            top: ${y}px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: scale(0);
            animation: ripple 0.6s ease-out;
            pointer-events: none;
        `

    button.style.position = "relative"
    button.style.overflow = "hidden"
    button.appendChild(ripple)

    setTimeout(() => {
      ripple.remove()
    }, 600)
  }
})

// Add CSS for ripple animation
const rippleStyle = document.createElement("style")
rippleStyle.textContent = `
    @keyframes ripple {
        to {
            transform: scale(2);
            opacity: 0;
        }
    }
`
document.head.appendChild(rippleStyle)
